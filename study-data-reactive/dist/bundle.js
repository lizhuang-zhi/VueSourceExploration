(()=>{"use strict";const t=function(t,e,s,r){Object.defineProperty(t,e,{value:s,enumerable:r,configurable:!0,writable:!0})};var e=0;class s{constructor(){this.id=e++,this.subs=[]}addSub(t){this.subs.push(t)}depend(){s.target&&this.addSub(s.target)}notify(){console.log("我是notify");const t=this.subs.slice();for(let e=0,s=t.length;e<s;e++)t[e].update()}}function r(t,e,r){const o=new s;console.log("侦听："+e+" 属性"),2==arguments.length&&(r=t[e]);let n=l(r);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:()=>(console.log("访问属性："+e),s.target&&(o.depend(),n&&n.dep.depend()),r),set(t){console.log("你试图改变 "+e+" 属性",t),r!==t&&(r=t,n=l(t),o.notify())}})}const o=Array.prototype;let n=Object.create(o);["push","pop","shift","unshift","splice","sort","reverse"].forEach((e=>{const s=o[e];t(n,e,(function(){const t=s.apply(this,arguments),r=this.__ob__;let o=[];switch(e){case"push":case"unshift":o=arguments;break;case"splice":o=[...arguments].slice(2)}return o&&r.observeArray(o),t}),!1)}));class i{constructor(e){this.dep=new s,t(e,"__ob__",this,!1),Array.isArray(e)?(Object.setPrototypeOf(e,n),this.observeArray(e)):this.walk(e)}walk(t){for(let e in t)r(t,e)}observeArray(t){for(let e=0,s=t.length;e<s;e++)l(t[e])}}function l(t){if("object"!=typeof t)return;let e;return e=void 0!==t.__ob__?t.__ob__:new i(t),e}var c=0,a={a:{m:{n:5}},b:10,c:{d:{e:{f:666}}},g:[22,33,44,55]};l(a),new class{constructor(t,e,s){this.id=c++,this.target=t,this.getter=function(t){let e=t.split(".");return t=>{for(let s=0;s<e.length;s++){if(!t)return;t=t[e[s]]}return t}}(e),this.callback=s,this.value=this.get()}update(){this.run()}get(){s.target=this;const t=this.target;var e;try{e=this.getter(t)}finally{s.target=null}return e}run(){this.getAndInvoke(this.callback)}getAndInvoke(t){const e=this.get();if(e!==this.value||"object"==typeof e){const s=this.value;this.value=e,t.call(this.target,e,s)}}}(a,"a.m.n",(t=>{console.log("555",t)})),a.a.m.n=88,console.log(a)})();